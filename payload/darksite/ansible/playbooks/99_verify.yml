- name: Verify cluster state
  hosts: master
  become: true
  tasks:
    - name: Nodes ready
      shell: |
        set -euo pipefail
        kubectl get nodes -o wide
        kubectl get nodes | awk 'NR>1{print $2}' | grep -v Ready && exit 1 || true
      args:
        executable: /bin/bash

    - name: Cilium healthy
      shell: |
        set -euo pipefail
        cilium status --wait
      args:
        executable: /bin/bash

    - name: ArgoCD pods ready
      shell: |
        set -euo pipefail
        kubectl get pods -n argocd
      args:
        executable: /bin/bash


---
- name: Preflight (bootstrap python only; Salt is out-of-scope here)
  hosts: all
  become: true
  gather_facts: false

  tasks:
    - name: Ensure python3 exists (raw bootstrap)
      raw: |
        set -euo pipefail
        if ! command -v python3 >/dev/null 2>&1; then
          export DEBIAN_FRONTEND=noninteractive
          apt-get update
          apt-get install -y python3 python3-apt
        fi
      register: _python_bootstrap
      changed_when: false
      when: ansible_connection != 'local'

    - name: Gather facts
      ansible.builtin.setup:


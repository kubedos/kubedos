global
  log /dev/log local0
  maxconn 4096
defaults
  mode tcp
  timeout connect 5s
  timeout client  50s
  timeout server  50s

frontend k8s_api
  bind {{ k8s_node_ip }}:6443
  default_backend kube_apiserver

backend kube_apiserver
    balance roundrobin
{% for h in groups['control_plane'] %}
    server {{ h }} {{ hostvars[h].k8s_node_ip }}:6443 check
{% endfor %}


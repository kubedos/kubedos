---
- name: Compute canonical short hostname (sanitized)
  ansible.builtin.set_fact:
    canonical_short_hostname: "{{ inventory_hostname_short | lower | trim | regex_replace('\\s+', '') }}"

- name: Resolve cluster domain (explicit or derived)
  ansible.builtin.set_fact:
    cluster_domain_effective: >-
      {{
        (cluster_domain | default('') | trim)
        if ((cluster_domain | default('') | trim) != '')
        else (
          (inventory_hostname.split('.', 1)[1] | trim)
          if ('.' in inventory_hostname)
          else ''
        )
      }}

- name: Fail fast if cluster domain could not be determined
  ansible.builtin.assert:
    that:
      - (cluster_domain_effective | trim) != ""
    fail_msg: >-
      cluster_domain is undefined/empty and could not be derived from inventory_hostname={{ inventory_hostname }}.
      Define cluster_domain in group_vars/all.yml (recommended).

- name: Compute cluster domain (sanitized)
  ansible.builtin.set_fact:
    cluster_domain_clean: "{{ (cluster_domain_effective | lower | trim) | regex_replace('\\s+', '') }}"

---
- name: Set fact-host (single source of truth host for run_once facts)
  set_fact:
    k8s_fact_host: "{{ ansible_play_hosts_all[0] }}"

- name: Set effective k8s node IP (defaults to ansible_default_ipv4.address)
  set_fact:
    k8s_node_ip_effective: "{{ (k8s_node_ip | default(ansible_default_ipv4.address, true)) | trim }}"

- name: Sanity check effective k8s node IP
  assert:
    that:
      - (k8s_node_ip_effective | default('') | trim) != ""
    fail_msg: "Unable to determine k8s_node_ip_effective (k8s_node_ip not set and ansible_default_ipv4.address missing)."

- name: Install Kubernetes packages and dependencies
  include_tasks: pkgs.yml

